# 도시 편의성 분석 대시보드

정책 의사결정을 위한 도시 분석 대시보드 및 시민용 공개 뷰

## 프로젝트 구조

```
frontend/
├── src/
│   ├── components/
│   │   ├── admin/          # 관리자 대시보드 컴포넌트
│   │   │   ├── PriorityQueue.tsx          # 우선순위 검사 대기열
│   │   │   ├── BlindSpotDetection.tsx     # 사각지대 탐지
│   │   │   ├── TimePatternAnalysis.tsx    # 시간대별 패턴 분석
│   │   │   ├── ActionRecommendations.tsx  # 개입 권고사항
│   │   │   ├── BeforeAfterTracking.tsx    # 개입 전후 효과 추적
│   │   │   ├── LocationMap.tsx             # 위치 지도 시각화
│   │   │   └── IndexCalculationModal.tsx  # 지수 계산 근거 모달
│   │   ├── public/         # 시민용 공개 뷰 컴포넌트
│   │   │   ├── TrendIndicators.tsx        # 전체 추세 지표
│   │   │   ├── RegionalTrendMap.tsx       # 지역별 현황 지도
│   │   │   ├── SignalTrends.tsx           # 지역별 신호 추세
│   │   │   ├── ImprovementStatus.tsx      # 개선 현황
│   │   │   └── ReportingGuide.tsx         # 민원 신고 안내
│   │   └── Layout.tsx      # 레이아웃 및 네비게이션
│   ├── pages/
│   │   ├── AdminDashboard.tsx    # 관리자 대시보드 페이지
│   │   └── PublicView.tsx        # 시민용 공개 뷰 페이지
│   ├── styles/
│   │   └── design-system.css    # 디자인 시스템 (색상, 타이포그래피, 간격)
│   ├── utils/
│   │   └── api.ts               # API 클라이언트 및 유틸리티
│   ├── App.tsx                  # 라우팅 설정
│   └── main.tsx                  # 애플리케이션 진입점
├── package.json
└── vite.config.ts
```

## 디자인 시스템

### 색상 팔레트
- **Primary**: Chateau Green (도시 편의성 강조, 긍정적 신호)
- **Neutral**: 흰색, 회색 계열 (대부분의 배경 및 텍스트)

### 타이포그래피
- 모든 제목과 헤딩: `letter-spacing: -1px` 적용
- 명확한 계층 구조를 통한 시각적 구분

### 레이아웃 원칙
- 넉넉한 여백과 공간
- 섹션 기반 레이아웃 (카드 그리드 최소화)
- Apple 스타일의 미니멀한 디자인

## 설치 및 실행

```bash
# 의존성 설치
npm install

# 환경 변수 설정 (선택사항)
# .env.local 파일을 생성하고 설정하세요
# VITE_MAPBOX_TOKEN=your_token_here          # Mapbox 토큰 (선택사항)
# VITE_API_BASE_URL=https://backend-rjk3.onrender.com  # 백엔드 API URL (선택사항, 기본값 사용 가능)
# 토큰이 없어도 기본 공개 토큰으로 동작합니다

# 개발 서버 실행
npm run dev

# 빌드
npm run build
```

## 백엔드 API 연동

프론트엔드는 백엔드 API와 연동되어 실시간 데이터를 표시합니다. API 연동이 실패할 경우 자동으로 더미데이터로 전환되어 UI는 정상적으로 작동합니다.

### 백엔드 서버
- **기본 URL**: `https://backend-rjk3.onrender.com`
- **환경 변수**: `VITE_API_BASE_URL`로 커스터마이징 가능

### API 연동 상태

#### ✅ 연동 완료된 기능 (관리자 대시보드)

1. **우선순위 검사 대기열** (`PriorityQueue`)
   - API: `GET /api/v1/priority-queue`
   - 날짜별 우선순위 대기열 데이터 조회
   - Fallback: 더미데이터 자동 전환

2. **개입 권고사항** (`ActionRecommendations`)
   - API: `GET /api/v1/action-cards`
   - 날짜 및 지역별 권고사항 조회
   - Fallback: 더미데이터 자동 전환

3. **시간대별 패턴 분석** (`TimePatternAnalysis`)
   - API: `GET /api/v1/dashboard/time-pattern`
   - 지역별 시간 패턴 데이터 조회
   - Fallback: 더미데이터 자동 전환

4. **사각지대 탐지** (`BlindSpotDetection`)
   - API: `GET /api/v1/dashboard/blind-spots`
   - 위험도별 사각지대 탐지 데이터 조회
   - Fallback: 더미데이터 자동 전환

5. **개입 전후 효과 추적** (`BeforeAfterTracking`)
   - API: `GET /api/v1/dashboard/interventions`, `GET /api/v1/dashboard/interventions/{id}/effect`
   - 완료된 개입 효과 데이터 조회
   - Fallback: 더미데이터 자동 전환

6. **핵심 액션 요약** (`AdminDashboard`)
   - 우선순위 큐와 액션 카드를 통합하여 요약 정보 표시
   - 실시간 우선순위 검사 대기 건수 및 즉시 개입 권고 건수 계산

#### 🔄 더미데이터 유지 기능

일부 상세 정보는 API 응답에 포함되지 않아 더미데이터로 표시됩니다:
- 우선순위 큐 내부의 상세 신호 정보 (`humanSignals`, `geoSignals`, `populationSignals` 상세 데이터)
- 개입 권고사항의 비용-효과 분석 상세 정보
- 전문가 검증 정보

#### 📝 API 클라이언트 구조

`src/utils/api.ts`에 `ApiClient` 클래스가 구현되어 있으며, 모든 API 호출을 중앙 관리합니다:
- 공통 에러 처리
- 로딩 상태 관리
- 타입 안전성 보장
- 상세한 에러 로깅

### API 연동 패턴

모든 컴포넌트는 다음 패턴을 따릅니다:
1. API 호출 시도
2. 성공 시: 실제 데이터 표시
3. 실패 시: 에러 메시지 표시 + 더미데이터로 자동 전환
4. 로딩 상태 표시

## 주요 기능

### 관리자 대시보드

#### 핵심 액션 요약
대시보드 상단에 우선순위가 높은 항목을 한눈에 볼 수 있는 요약 카드를 제공합니다.

- **우선순위 검사 대기 건수**: E/D 등급 지역의 개수
- **즉시 개입 권고 건수**: urgent/immediate 태그가 있는 권고사항 개수
- **최우선 지역 정보**: 상위 1순위 지역의 편의성 지수 및 위치
- **최우선 권고사항**: 가장 우선순위가 높은 개입 권고사항 정보

#### 우선순위 검사 대기열 ✅ API 연동 완료
도시 편의성 지수를 기반으로 한 순위별 검사 목록을 제공합니다.

- **대기열 시각화**: 각 지역을 순위별로 카드 형태로 표시하여 실제 대기열처럼 시각화
- **상세 정보 조회**: 대기열에서 지역을 클릭하면 해당 지역의 상세 분석 정보 표시
- **신호 분석**: 인간 신호, 지리 신호, 생활인구 신호, 비둘기 신호(해석 레이어)를 종합 분석
- **우선순위 결정 근거**: 야간 민원 급증, 골목 구조 취약, 생활인구 변화 등 결정 요인 표시
- **교란요인 분석**: 급이, 계절성, 상권, 기상, 이벤트 등 교란요인 식별 및 국립생태원 자문 반영
- **신호 교차 검증**: Human-Geo 일치도, Human-Population 일치도, 전체 신호 일치도 측정
- **사각지대 위험도**: 신호 간 불일치를 통한 사각지대 탐지 및 위험도 평가
- **지수 계산 근거**: 편의성 지수 계산 방법 및 데이터 출처 상세 정보 제공

#### 사각지대 탐지 ✅ API 연동 완료
신호 간 불일치를 분석하여 행정 데이터가 놓치는 사각지대를 탐지합니다.

- 위험도별 사각지대 목록 표시
- 탐지 사유 및 권고 조치 표시
- 지도 기반 시각화 (추가 개발 가능)

#### 시간대별 패턴 분석 ✅ API 연동 완료
민원 발생 시간대와 생활인구 패턴을 분석하여 최적의 관리 시점을 제안합니다.

- 시간대별 패턴 차트
- 요일별 패턴 분석
- 피크 시간대 식별

#### 개입 권고사항 ✅ API 연동 완료
데이터 기반 개입 유형 및 예상 효과를 분석합니다.

- 개입 유형별 권고사항 (구조 개선, 정기 관리 강화, 모니터링 강화 등)
- 예상 효과 및 비용 효율성 분석 (ROI, 민원 감소 예상치, 지수 개선 예상치)
- 권장 시간대 및 요일 패턴 제시
- 관련 신호 표시 (인간, 지리, 생활인구, 비둘기 신호)

#### 개입 전후 효과 추적 ✅ API 연동 완료
과거 개입 사례의 효과를 측정 및 검증합니다.

- 개입 전후 편의성 지수 변화 추이 시각화
- 개선 효과 정량화 (점수 상승치)
- 개입 유형별 효과 비교

#### 네비게이션 메뉴
각 섹션으로 부드럽게 이동할 수 있는 상단 고정 메뉴 바를 제공합니다.

### 시민용 공개 뷰

#### 전체 추세 지표
도시 전역의 편의성 지수 변화 추이를 시각화합니다.

- 현재 도시 편의성 지수 및 전 분기 대비 변화율
- 지속적 개선 추세 확인
- 분기별 추이 차트

#### 지역별 현황
구 단위 지역별 도시 편의성 상태를 지도로 표시합니다. 정확한 위치 정보는 공개되지 않습니다.

#### 지역별 신호 추세
구 단위 지역별 신호 변화 추이를 분석합니다.

#### 개선 현황
진행 중인 도시 편의성 개선 사업 현황을 표시합니다.

- 개선 중, 안정적, 모니터링 중, 완료 상태별 분류
- 진행률 및 최종 업데이트 날짜
- 완료된 사업의 완료일 표시

#### 민원 신고 안내
간단한 절차로 도시 편의성과 관련된 문제를 신고할 수 있습니다.

#### 네비게이션 메뉴
각 섹션으로 부드럽게 이동할 수 있는 상단 고정 메뉴 바를 제공합니다.

## 데이터 분석 방법론

### 신호 체계

이 대시보드는 다층 신호 분석을 통해 도시 편의성을 평가합니다.

#### Core 지표
- **인간 신호**: 민원 건수, 추세, 재발 횟수, 피크 시간대 분석
- **지리 신호**: 골목 구조, 환기 상태, 접근성, 취약도 점수
- **생활인구 신호**: 주간/야간 생활인구, 변화율, 추세 분석

#### 해석 레이어
- **비둘기 신호**: 생태적 신호로 환경 변화를 감지하는 보조 검증 레이어
  - Core 지표의 보조 검증 레이어로 활용
  - 민원 데이터와 교차 검증 필요
  - 강도, 활동 빈도, 활동 패턴 분석

### 우선순위 결정 알고리즘

우선순위는 다음 요소들을 종합하여 결정됩니다:

1. **신호 상승률**: 각 신호의 증가 속도
2. **구조적 취약도**: 지리적 특성에 따른 취약도 점수
3. **신호 일치도**: 여러 신호 간의 일치 정도
4. **교란요인**: 급이, 계절성, 상권 등 외부 요인 고려
5. **전문가 검증**: 국립생태원 자문 반영

### 편의성 지수 계산

Urban Comfort Index는 Core 지표와 해석 레이어를 종합하여 계산됩니다. 각 데이터 출처의 신뢰도와 최종 업데이트 날짜가 고려됩니다.

## 기술 스택

- **React 18**: 사용자 인터페이스 구축
- **TypeScript**: 타입 안정성 보장
- **Vite**: 빠른 개발 서버 및 빌드 도구
- **React Router**: 클라이언트 사이드 라우팅
- **Recharts**: 차트 및 데이터 시각화
- **Mapbox GL JS**: 지도 시각화 및 상호작용
- **React Map GL**: Mapbox와 React 통합

## 디자인 철학

이 대시보드는 일반적인 관리자 대시보드가 아닌 **정책 의사결정 도구**입니다.

- Apple 공식 웹사이트 스타일의 차분하고 자신감 있는 미니멀 디자인
- 타이포그래피와 간격을 통한 강한 계층 구조
- 넉넉한 여백
- 절제되었지만 의도적인 색상 사용
- 무거운 테두리나 박스형 UI 최소화
- 반응형 디자인으로 다양한 화면 크기 지원

학술/정책 발표에서 신뢰할 수 있는 시각적 품질을 목표로 합니다.

## 사용 방법

### 관리자 대시보드 접근
`/admin` 경로로 접근하거나 루트 경로에서 자동으로 리다이렉트됩니다.

### 시민용 공개 뷰 접근
`/public` 경로로 접근합니다.

### 네비게이션
각 페이지 상단의 메뉴 바를 통해 섹션 간 빠르게 이동할 수 있습니다. 메뉴 항목을 클릭하면 해당 섹션으로 부드럽게 스크롤됩니다.

### 우선순위 대기열 사용
1. 대기열에서 지역 카드를 클릭하여 상세 정보 확인
2. 편의성 지수 배지를 클릭하여 지수 계산 근거 확인
3. 각 신호의 데이터 출처 및 신뢰도 확인
4. 교차 검증 결과를 통한 사각지대 위험도 확인

## 개발 참고사항

### 디자인 시스템 변수
모든 색상, 간격, 타이포그래피는 `src/styles/design-system.css`에서 CSS 변수로 정의되어 있습니다.

### 컴포넌트 구조
각 컴포넌트는 자체 CSS 파일을 가지고 있으며, 디자인 시스템 변수를 활용합니다.

### 데이터 구조 및 API 연동

프론트엔드는 백엔드 API와 연동되어 있으며, 다음과 같은 구조로 동작합니다:

1. **API 우선 사용**: 모든 컴포넌트는 먼저 백엔드 API에서 데이터를 조회합니다.
2. **Fallback 메커니즘**: API 호출 실패 시 자동으로 더미데이터로 전환하여 UI가 정상 작동하도록 합니다.
3. **에러 처리**: API 오류 시 사용자에게 명확한 에러 메시지를 표시합니다.
4. **로딩 상태**: 데이터 로딩 중에는 적절한 로딩 표시를 제공합니다.

### API 클라이언트 사용법

```typescript
import { apiClient, getTodayDateString } from '../utils/api'

// API 호출 예시
const date = getTodayDateString()
const priorityQueue = await apiClient.getPriorityQueue({ date, top_n: 20 })
const actionCards = await apiClient.getActionCards({ date })
```

### 추가 참고 문서

- **백엔드 연동 상세 보고서**: `BACKEND_INTEGRATION_REPORT.md` 참조
- **API 상태**: `API_STATUS.md` 참조 (백엔드 서버 상태 확인용)

